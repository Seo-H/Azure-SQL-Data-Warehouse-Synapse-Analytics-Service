# 빠른 노트: 데이터 스키마 설계

## 데이터베이스 스키마란 무엇인가?
- 데이터 구성 방식을 정의함
- 데이터베이스에 의미를 부여함
- 물리적 및 논리적 카테고리로 구분됨

## 스타 스키마 vs 스노우플레이크 스키마
### 스타 스키마
- 쿼리하기 쉬움
- 1개의 팩트 테이블
- 1단계 차원 테이블
- 정규화되지 않음

### 스노우플레이크 스키마
- 쿼리 성능 감소
- 여러 차원 테이블
- 정규화됨

## 데이터 웨어하우스 소개
- 정보의 저장소
- 데이터 레이아웃과 유형을 설명하는 스키마로 구성된 데이터
- 중복 데이터가 없는 테이블에 저장됨

### 클라우드 데이터 웨어하우스
- 확장성
- 비용
- 시장 출시 시간
- 성능

## 관계형 vs 비관계형
### 관계형 데이터베이스 - SQL
- 기본 키와 외래 키
- ACID(원자성, 일관성, 격리성, 지속성)

### 비관계형 데이터베이스 - NoSQL
- 패밀리

## 데이터 모델과 팩트 테이블
- 차원: 속성
- 팩트 테이블: 스키마의 중심
- 빅데이터 솔루션의 핵심 구성요소

### 빅데이터 솔루션 구성요소
- 수집: Data Factory
- 저장: Blob Storage
- 준비: Databricks, HDInsight
- 모드: SQL Data Warehouse
- 보고: Power BI

## 대규모 병렬 처리(MPP) 엔진
- 데이터 웨어하우스 단위
- 컴퓨팅과 스토리지의 분리
- 페타바이트 규모의 데이터에서 복잡한 쿼리를 실행하기 위한 대규모 병렬 처리 도구

## 분산
- 60의 법칙, 컴퓨팅 및 제어
- 샤딩 패턴:
  - 해시: 대규모 테이블에 대한 최고의 쿼리 성능
  - 라운드 로빈: 스테이징 테이블 생성이 가장 쉬움
  - 복제: 소규모 테이블에 대한 가장 빠른 쿼리

## PolyBase 소개
- PolyBase: SQL DW의 관계형 데이터와 HDFS(Hadoop Distributed File System)의 비관계형 Hadoop 데이터 간 쿼리 가능
- 전통적인 ETL 대신 ELT 사용 가능
- 데이터 웨어하우스에서 변환 수행
- 여러 데이터베이스에 변환 작업 분산

### 기본 단계
1. 소스 데이터를 텍스트 파일로 추출
2. Azure Blob 스토리지 또는 Azure Data Lake Store에 데이터 저장
3. 로딩을 위한 데이터 준비
4. PolyBase를 사용하여 SQL Data Warehouse 스테이징 테이블에 데이터 로드
5. 데이터 변환
6. 프로덕션 테이블에 데이터 삽입

## SQL Data Warehouse 최적화
- Advisor 권장 사항을 확인했나요?
- PolyBase를 사용하여 데이터 로드 및 내보내기
- CREATE TABLE AS SELECT 사용
- 대규모 테이블은 해시 분산
- 올바른 분산 유형 선택
- 60의 법칙 기억하기
- 과도한 파티셔닝 피하기
- 워크로드 결정을 위한 파티셔닝 실험
- gzip을 60개 이상의 파일로 분할하여 처리량 최대화
- 트랜잭션 크기 최소화
- 열 크기 최소화

## Azure SQL Data Warehouse 문제 해결
- DWU(Data Warehouse Unit): SQL Data Warehouse에서 사용되는 측정 단위